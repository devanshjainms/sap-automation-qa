# Investigation Patterns Configuration (Hints-Based)
#
# Provides metadata-driven investigation guidance without hardcoded commands.
# Patterns map problem descriptions to recommended check tags and categories.
#
# Structure:
#   - investigation_hints: Problem patterns with recommended checks
#   - baseline_checks: Standard baseline check tags for different scopes

---
investigation_hints:
  # -------------------------------------------------------------------------
  # STONITH / Fencing Issues
  # -------------------------------------------------------------------------
  stonith_issues:
    description: "Azure fencing agent (STONITH) failures or configuration issues"
    keywords:
      - "stonith"
      - "fence"
      - "fencing"
      - "rsc_st_azure"
      - "azure agent"
    recommended_check_tags:
      - "stonith-config"
      - "cluster-status"
      - "azure-config"
      - "high-availability"
    category_hints:
      - "high_availability"
      - "azure"
    severity: "high"
    
  # -------------------------------------------------------------------------
  # Resource Failures
  # -------------------------------------------------------------------------
  resource_failure:
    description: "Cluster resource failures, start/stop issues, or migration problems"
    keywords:
      - "resource fail"
      - "failed to start"
      - "failed to stop"
      - "resource.*error"
      - "migration"
      - "failover"
    recommended_check_tags:
      - "cluster-status"
      - "resource-status"
      - "resource-config"
      - "constraints"
    category_hints:
      - "high_availability"
    severity: "high"
    
  # -------------------------------------------------------------------------
  # Split Brain
  # -------------------------------------------------------------------------
  split_brain:
    description: "Cluster split-brain or quorum loss scenarios"
    keywords:
      - "split brain"
      - "split-brain"
      - "quorum"
      - "partition"
      - "both nodes active"
    recommended_check_tags:
      - "cluster-status"
      - "node-status"
      - "quorum-config"
      - "network-connectivity"
    category_hints:
      - "high_availability"
      - "network"
    severity: "critical"
    
  # -------------------------------------------------------------------------
  # SAP Process Issues
  # -------------------------------------------------------------------------
  sap_process_failure:
    description: "SAP application process failures (HANA, ASCS, ERS)"
    keywords:
      - "sap.*fail"
      - "hana.*down"
      - "ascs.*fail"
      - "ers.*fail"
      - "sapstartsrv"
      - "hdb.*process"
    recommended_check_tags:
      - "sap-status"
      - "hana-status"
      - "ascs-status"
      - "process-check"
    category_hints:
      - "sap"
      - "hana"
      - "ascs"
    severity: "high"
    
  # -------------------------------------------------------------------------
  # Network Issues
  # -------------------------------------------------------------------------
  network_issues:
    description: "Network connectivity or Azure load balancer problems"
    keywords:
      - "network"
      - "connectivity"
      - "timeout"
      - "load.*balancer"
      - "lb.*probe"
      - "connection.*refused"
    recommended_check_tags:
      - "network-connectivity"
      - "azure-lb-config"
      - "network-config"
    category_hints:
      - "network"
      - "azure"
    severity: "medium"
    
  # -------------------------------------------------------------------------
  # Package/Dependency Issues
  # -------------------------------------------------------------------------
  package_issues:
    description: "Missing packages or dependency problems"
    keywords:
      - "package.*missing"
      - "not found"
      - "dependency"
      - "rpm"
      - "zypper"
      - "yum"
    recommended_check_tags:
      - "package-check"
      - "dependency-check"
    category_hints:
      - "package"
    severity: "medium"
    
  # -------------------------------------------------------------------------
  # Configuration Drift
  # -------------------------------------------------------------------------
  configuration_drift:
    description: "Configuration mismatch or drift from expected values"
    keywords:
      - "configuration"
      - "mismatch"
      - "drift"
      - "expected.*value"
      - "incorrect.*setting"
    recommended_check_tags:
      - "cluster-config"
      - "resource-config"
      - "azure-config"
      - "sap-config"
    category_hints:
      - "high_availability"
      - "sap"
    severity: "medium"
    
  # -------------------------------------------------------------------------
  # Virtual Machine Issues
  # -------------------------------------------------------------------------
  vm_issues:
    description: "Azure VM configuration or status problems"
    keywords:
      - "vm"
      - "virtual machine"
      - "azure.*instance"
      - "vm.*stop"
      - "vm.*restart"
    recommended_check_tags:
      - "vm-status"
      - "vm-config"
      - "azure-config"
    category_hints:
      - "virtual_machine"
      - "azure"
    severity: "medium"

# -----------------------------------------------------------------------------
# Baseline Checks
# -----------------------------------------------------------------------------
# Standard sets of checks to establish system health baseline
# These are executed before targeted investigation to understand current state

baseline_checks:
  # Minimal baseline - fastest, for quick health checks
  minimal:
    - "cluster-status"
    - "node-status"
    - "resource-status"
  
  # Standard baseline - comprehensive cluster health
  standard:
    - "cluster-status"
    - "node-status"
    - "resource-status"
    - "stonith-config"
    - "network-connectivity"
    - "sap-status"
  
  # Comprehensive baseline - full validation
  comprehensive:
    - "cluster-status"
    - "node-status"
    - "resource-status"
    - "stonith-config"
    - "resource-config"
    - "constraints"
    - "network-connectivity"
    - "network-config"
    - "azure-lb-config"
    - "sap-status"
    - "hana-status"
    - "ascs-status"
    - "package-check"

# -----------------------------------------------------------------------------
# Investigation Settings
# -----------------------------------------------------------------------------

settings:
  # Minimum confidence score for pattern matching (0.0 - 1.0)
  min_confidence: 0.3
  
  # Default baseline scope when no specific scope requested
  default_baseline: "standard"
  
  # Cache TTL for baseline results (seconds)
  baseline_cache_ttl: 300
  
  # Maximum number of patterns to suggest if multiple matches
  max_pattern_suggestions: 3
  
  # Enable category-based fallback when no pattern matches
  enable_category_fallback: true
  
  # Severity-based prioritization
  severity_priority:
    critical: 100
    high: 75
    medium: 50
    low: 25
